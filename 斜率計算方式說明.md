# 趨勢線斜率計算方式說明

## 問題: 絕對價格 vs 標準化價格

### 方案 A: 直接用絕對價格計算斜率

**計算方式**:
```python
價格序列: [100, 102, 105, 103, 104]
趨勢線: y = ax + b
斜率 a = +1.0 (每天漲 1 元)
```

**問題**:
```
GOOG 股票:
價格: [330, 335, 340, 345, 350]
斜率: +5.0 (每天漲 5 元)

ELF 股票:
價格: [85, 86, 87, 88, 89]
斜率: +1.0 (每天漲 1 元)

模型會認為:
- GOOG 的趨勢更強 (斜率 +5.0)
- ELF 的趨勢較弱 (斜率 +1.0)

但實際上:
- GOOG 漲幅: 5/330 = 1.5% 每天
- ELF 漲幅: 1/85 = 1.2% 每天
→ 兩者趨勢強度其實差不多！
```

**優點**:
- 簡單直觀
- 保留了絕對價格資訊

**缺點**:
- 不同價格的股票無法公平比較
- 高價股的斜率數值會遠大於低價股
- 模型可能偏向高價股

---

### 方案 B: 標準化後計算斜率 (推薦)

**計算方式**:
```python
原始價格: [100, 102, 105, 103, 104]

標準化 (除以第一天價格):
[1.00, 1.02, 1.05, 1.03, 1.04]

趨勢線斜率: +0.01 (每天漲 1%)
```

**優點**:
```
GOOG 股票:
價格: [330, 335, 340, 345, 350]
標準化: [1.00, 1.015, 1.030, 1.045, 1.061]
斜率: +0.015 (每天漲 1.5%)

ELF 股票:
價格: [85, 86, 87, 88, 89]
標準化: [1.00, 1.012, 1.024, 1.035, 1.047]
斜率: +0.012 (每天漲 1.2%)

模型會認為:
- GOOG 趨勢: +0.015 (1.5%/天)
- ELF 趨勢: +0.012 (1.2%/天)
→ 公平比較！
```

**優點**:
- 不同價格的股票可以公平比較
- 斜率直接反映百分比變化
- 模型不會偏向高價股或低價股

**缺點**:
- 需要額外的標準化步驟

---

### 方案 C: 用變化率計算斜率

**計算方式**:
```python
原始價格: [100, 102, 105, 103, 104]

轉換為變化率:
[+2%, +2.9%, -1.9%, +0.97%]

累積變化率:
[+2%, +4.9%, +3.0%, +3.97%]

趨勢線斜率: +1.0 (每天累積漲 1%)
```

**這就是我之前實作的方式**

**優點**:
- 標準化，不同股票可比較
- 直接反映漲跌幅

**缺點**:
- 你說這不是你想要的 :)

---

## 我的建議

**使用方案 B (標準化後計算斜率)**

理由:
1. 保留了「價格趨勢」的概念 (你想要的)
2. 解決了不同價格股票無法比較的問題
3. 斜率數值直接對應百分比變化

**實作方式**:
```python
def extract_overlapping_slopes(prices, num_segments=5):
    # 標準化: 除以第一個價格
    if prices[0] != 0:
        normalized_prices = prices / prices[0]
    else:
        normalized_prices = prices
    
    # 計算趨勢線斜率
    slopes = []
    for each segment:
        slope = calculate_trend_slope(normalized_prices[segment])
        slopes.append(slope)
    
    return slopes
```

**結果解讀**:
- 斜率 = +0.01 → 每天漲 1%
- 斜率 = +0.005 → 每天漲 0.5%
- 斜率 = -0.01 → 每天跌 1%

---

## 你的選擇

請告訴我你想用哪個方案:

**A. 直接用絕對價格** (簡單，但不同價格股票無法比較)
**B. 標準化後計算** (推薦，公平比較)
**C. 用變化率** (我之前做的，但你說不是你要的)

或者你有其他想法？
