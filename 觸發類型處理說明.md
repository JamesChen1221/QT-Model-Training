# 觸發類型與財報資料處理說明

## 觸發類型定義

1. **觸發類型 1 - 財報為主**
   - 有完整財報數據: EPS Surprise, Revenue Surprise, 展望
   - 可能也有消息情緒分數（財報發布通常伴隨消息）

2. **觸發類型 2 - 消息為主**
   - **沒有**財報數據（EPS/Revenue/展望為空）
   - 有消息情緒分數
   - 例如: 重大新聞、產品發布、管理層變動等

3. **觸發類型 3 - 財報 + 消息**
   - 有完整財報數據
   - 有消息情緒分數
   - 例如: 財報發布同時有重大消息

## 資料處理邏輯

### 訓練時

```python
if 觸發類型 == 2:
    # 消息面觸發，財報欄位填 0
    EPS Surprise (%) = 0
    Revenue Surprise (%) = 0
    展望 (Guidance) = 0
else:
    # 觸發類型 1 或 3，財報欄位用中位數填補缺失值
    if 欄位為空:
        填入中位數
```

### 預測時

相同邏輯:
- 觸發類型 2 → 財報欄位填 0
- 觸發類型 1 或 3 → 財報欄位用中位數填補

## 模型如何學習

XGBoost 會自動學到不同觸發類型的模式:

### 觸發類型 1 (財報為主)
```
決策樹範例:
if (EPS Surprise > 10%):
    if (Revenue Surprise > 5%):
        → 預測: 高當沖潛力
    else:
        → 預測: 中等潛力
```

### 觸發類型 2 (消息為主)
```
決策樹範例:
if (觸發類型 == 2):
    if (消息情緒分數 > 80):
        if (120d_seg5_slope > 1.0):  # 最近上升
            → 預測: 高當沖潛力
        else:
            → 預測: 中等潛力
    else:
        → 預測: 低潛力
```

### 觸發類型 3 (財報 + 消息)
```
決策樹範例:
if (EPS Surprise > 10% AND 消息情緒分數 > 80):
    → 預測: 極高當沖潛力 (雙重利多)
```

## 為什麼這樣處理？

### 方案 A: 用中位數填補所有缺失值 ✗
```
問題:
觸發類型 2 的 EPS Surprise 填入中位數 (例如 5%)
→ 模型會誤以為有財報數據
→ 預測不準確
```

### 方案 B: 用 0 填補觸發類型 2 的財報欄位 ✓
```
優點:
觸發類型 2 的 EPS Surprise = 0
→ 模型知道「沒有財報數據」
→ 會依賴其他特徵 (消息、趨勢等)
→ 預測更準確
```

## 實際範例

### 範例 1: 財報驚喜 (觸發類型 1)
```
公司代碼: AAPL
觸發類型: 1
EPS Surprise: +15%
Revenue Surprise: +8%
展望: 1 (正面)
消息情緒分數: 85

模型判斷:
→ 財報超預期 + 展望正面 + 消息正面
→ 預測: 高當沖潛力
```

### 範例 2: 重大新聞 (觸發類型 2)
```
公司代碼: TSLA
觸發類型: 2
EPS Surprise: 0 (填入)
Revenue Surprise: 0 (填入)
展望: 0 (填入)
消息情緒分數: 90
120d_seg5_slope: +2.5 (強勢上升)

模型判斷:
→ 沒有財報，但消息極正面 + 趨勢強勢
→ 預測: 高當沖潛力
```

### 範例 3: 財報 + 重大消息 (觸發類型 3)
```
公司代碼: NVDA
觸發類型: 3
EPS Surprise: +20%
Revenue Surprise: +12%
展望: 1 (正面)
消息情緒分數: 95
120d_seg5_slope: +3.0

模型判斷:
→ 財報大超預期 + 重大利多消息 + 強勢趨勢
→ 預測: 極高當沖潛力 (三重利多)
```

## 使用建議

### 填寫訓練資料時
1. 確保觸發類型正確
2. 觸發類型 2 的財報欄位可以留空（程式會自動填 0）
3. 觸發類型 1 和 3 必須填寫財報數據

### 填寫預測資料時
1. 確定觸發類型
2. 如果是消息面 (類型 2)，財報欄位留空即可
3. 如果是財報面 (類型 1 或 3)，必須填寫財報數據

## 注意事項

- 目前訓練資料全部是觸發類型 1
- 建議收集一些觸發類型 2 和 3 的資料
- 這樣模型才能學到不同觸發類型的模式
- 等資料多了，可以分析不同觸發類型的當沖潛力差異
