# 欄位標記說明

## 欄位命名規則

在 `QT Training Data.xlsx` 中，使用特殊標記來標示欄位的用途：

### 1. `*` 開頭 = 忽略的欄位
這些欄位不會被用作模型訓練的特徵，包括：
- 中間計算結果（如 `*昨日收盤價`、`*開盤價格`）
- 管理用欄位（如 `*備註`）
- 已被取代的特徵（如 `*5天 RSI 序列`、`*5天 ADX 序列`）

**範例**:
- `*昨日收盤價`
- `*盤前 10 分鐘價格`
- `*備註`
- `*5天 RSI 序列`

### 2. `#` 開頭 = 目標標籤
這些是模型要預測的目標值，每個目標會訓練一個獨立的模型：

**範例**:
- `#開盤 (%)`
- `#10分鐘低價 (%)`
- `#1.5小時高價 (%)`
- `#最高價前的最低價 (%)`

### 3. 無標記 = 特徵欄位
沒有特殊標記的欄位會被用作訓練特徵：

**範例**:
- `5日高價距離 (%)`
- `產業`
- `觸發類型`
- `消息情緒分數`
- `EPS Surprise (%)`

## 特殊處理的欄位

### 序列欄位
- `120天收盤價序列`: 會被提取成15個趨勢斜率特徵
- `*5天 RSI 序列`: 已忽略（用 `*` 標記）
- `*5天 ADX 序列`: 已忽略（用 `*` 標記）

### 產業欄位
- 會自動轉換為 One-Hot Encoding
- 例如：`產業_10`、`產業_11`、`產業_12` 等

## 程式碼實作

### 訓練程式 (`train_qt_xgboost.py`)
```python
# 目標欄位: 以 '#' 開頭
self.target_columns = [col for col in self.data.columns if str(col).startswith('#')]

# 排除欄位: 開盤日期、公司代碼、目標欄位、以 '*' 開頭的欄位
exclude_cols = ['開盤日期', '公司代碼'] + self.target_columns
exclude_cols += [col for col in self.data.columns if str(col).startswith('*')]

# 特徵欄位: 不在排除列表中，且不包含'序列'
self.feature_columns = [col for col in self.data.columns 
                       if col not in exclude_cols 
                       and '序列' not in str(col)]
```

### 預測程式 (`predict_new_stocks.py`)
預測程式會自動使用訓練時儲存的 `feature_columns`，確保特徵一致性。

## 優點

1. **清晰明確**: 一眼就能看出欄位的用途
2. **易於維護**: 新增或移除特徵只需修改 Excel，不用改程式碼
3. **避免錯誤**: 不會誤用中間計算結果或管理欄位作為特徵
4. **靈活性高**: 可以輕鬆測試不同的特徵組合

## 目前使用的特徵

共 40 個特徵：
- 12 個基本特徵（價格距離、財報、情緒等）
- 15 個趨勢斜率特徵（從120天收盤價序列提取）
- 13 個產業 One-Hot 特徵

## 被排除的欄位

共 18 個欄位被標記為 `*` 而排除：
- 6 個價格欄位（昨日收盤價、開盤價格等）
- 4 個策略欄位（進場位置、獲利位置等）
- 6 個序列欄位（RSI/ADX 序列）
- 1 個管理欄位（備註）
- 1 個無效欄位（*.1）
